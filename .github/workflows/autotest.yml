name: Test 

on: 
  push:
    branches-ignore:
    - '*-prebuilt'

jobs:
  acceptance-test:
    name: Acceptance Test
    runs-on: ubuntu-latest
    strategy:
      matrix:
        goos: [linux, windows, darwin]
        goarch: [amd64, "386"]
        exclude:  
          - goarch: "386"
            goos: darwin 
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Set BUILD_TIME env
      run: echo BUILD_TIME=$(date) >> ${GITHUB_ENV}
    - name: Run go-release-action on test code
      uses: ./
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        goos: ${{ matrix.goos }}
        goarch: ${{ matrix.goarch }}
        goversion: https://golang.org/dl/go1.16.2.linux-amd64.tar.gz
        project_path: ./test/
        binary_name: testmain
        pre_command: go mod init localtest
        build_flags: -v
        ldflags: -X "main.buildTime=${{ env.BUILD_TIME }}" -X main.gitCommit=${{ github.sha }} -X main.gitRef=${{ github.ref }}
        md5sum: false
        sha256sum: true
        overwrite: true
        release_tag: v0.1-test-assets
        asset_name: testmain-${{ matrix.goos }}-${{ matrix.goarch }}

      